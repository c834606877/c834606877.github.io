---
layout: post
title: 歌华链路由器刷机历程

categories:
- Linux


tags: [路由器, 刷机]

author:
  login: lanbing
  email: c834606877@163.com
---



 

>> 一入恩山深似海，从此节操是路人。。。
>> 本文纯属闲扯，用到的方法恩山都有，但没有一个路径完全整合的方法，这里记录一下。



实验室的路由器一直用的还是大一买的，当时为便宜走奶茶家一次性买了俩，想着学校小水管D-Link内置天线就够用了，79包邮到一食堂门口。签收完，发现系统着实垃圾，但能用稳定还凑合，接有线一用就是四五年，直到现在9102年了都。

一直用的都是2.4Ghz频段的无线，因为宿舍区墙多隔离效果也好，实际对上网络要求不高，延迟要求不高的应用来讲，2.4Ghz频段的干扰也不大，不像商场比较开旷的地区，对普通应用体验来讲也是感觉不到干扰的。实际上干扰是存在的，主要表现为，当附近有2.4Ghz的大数据量传输时，其它设备会有严重丢包和Ping值变高的影响。



但由于去年的一个项目用到了内网无线UDP交互，而且对延迟要求很高，也就是键鼠操控的吃鸡的项目。鼠标与键盘连接到电脑，电脑将键鼠消息通过内网UDP封包来发送给iPad，而且键鼠操控的是PS类的游戏，对操控的延时有非常高的要求。

在实际体验过程中，完全暴露了2.4Ghz干扰的存在性。这里的干扰分为两类，一类是来自同一个无线网络中其它通信设备的干扰，二是来自外部2.4Ghz频段的干扰。比如2.4G通信的无线鼠标，2.4G的蓝牙设备，其它2.4G的无线网络的路由器等等。



为了应对这个问题，我起先将2.4G鼠标替换成了罗技的G102有线鼠标，主要是能自定义DIP，目前市场上低DIP的鼠标越来越不好选了，DIP越高，鼠标向上位机汇报的位移信息越多，上位机不需要这么多精确的位移信息，于是进行降采样，以降低鼠标速度，这一步显得多次一举了。直接减低鼠标DIP，可以提高鼠标的响应速度，并且PS类游戏瞄准也可以变简单一些。

另将iPad通过USB连接电脑，将无线网络转换为有线连接，这样一来，整套设备均用有线传输，去除了2.4Ghz的干扰。



最近偶尔刷刷路由器相关论坛，发现如今的路由器集成度已经非常高了，SMB，NAS，迅雷等等常用功能，甚至还有做到集成了家庭网关，语音音响等。



于是顺着论坛垃圾佬们的路子，到闲鱼找了几个配置比较高的路由器，比如友华*WR1200JS*，歌华链*GHL-R-001*，处理器和小米Pro是一个型号，前者功放芯片好一点，72一个，后者Ram和Flash大，60一个。友华到手已经刷好Padavan，虽然55有点问题，就不折腾了。

歌华链的没有刷过机，固件版本是1.2.6，恩山上说这个硬件有两个EEPROM版本，刷伪降级固件会因为CheckSUM对不上，导致不能启动。



后来刷论坛总结出一种方法，此方法适用不可降级的1.2.6：

**原版固件按住Reset后，会通过TFTP协议到192.168.1.100取一个firmware.bin的固件，以强制更新。通过这种方法可以降级官方固件，然后通过1.21固件自己开的telent端口连上路由器，刷入breed不死，再刷Padavan。**



接下来准备好工具以及要刷的固件。

1.  tftp服务器软件：[tftpd64](/post_res/2019-07-18-exp-flash-ghl-r-001-router.assets/tftpd64.462.zip)
2.  Http服务器软件: [HFS](/post_res/exp-flash-ghl-r-001-router.assets/Http+File+Server+2.3i+Build+297.zip)
3.  [breed](/post_res/2019-07-18-exp-flash-ghl-r-001-router.assets/breed-mt7621-pbr-m1.bin)
4.  歌华链1.21固件：[1.21固件](/post_res/2019-07-18-exp-flash-ghl-r-001-router.assets/GCloud_gh-a1_Build20180404_v1.21.bin)
5.  Padavan ：[Padavan](/post_res/2019-07-18-exp-flash-ghl-r-001-router.assets/MT7621_7603_7612_512M_3.4.3.9-099.trx)



### 一、降级

只有固件1.21的版本才能利用telent进行刷机，所以需要降级固件版本。

1、首先将本机电脑IP设置为192.168.1.100，网关为192.168.1.1，

2、将1.21固件改名为firmware.bin放置到tftpd64目录下，打开tftpd64软件，选择网络接口为192.168.1.100

3、断开路由器电源，用网线连接电脑和路由器Lan口，用针顶住Reset键，然后插入电源。

4、此时，tftp64上会提示，firmware.bin被下载，然后松开Reset键，等个十来分钟，路由器会自动将固件写进去。

5、这时，路由器貌似会自动重启，你可以用手机搜到歌华链的Wifi名称。

![QQ20190716155142](/post_res/2019-07-18-exp-flash-ghl-r-001-router.assets/QQ20190716155142.png)


### 二、刷入Breed

1、降级成功后可以通过网线连接电脑，自动获取到路由器分配的IP。

2、通过telent连接到192.168.9.1 2317端口。如下图所示：

![QQ20190716155657](/post_res/2019-07-18-exp-flash-ghl-r-001-router.assets/QQ20190716155657.png)

3、用hfs建立简单Http服务器，将breed-mt7621-pbr-m1.bin拖入hfs。

4、wget http://【你的IP地址】/breed-mt7621-pbr-m1.bin

5、mtd write breed-mt7621-pbr-m1.bin Bootloader 

![QQ20190716160123](/post_res/2019-07-18-exp-flash-ghl-r-001-router.assets/QQ20190716160123.png)



###　三、刷入Padavan

刷入了breed之后就可以对路由器为所欲为了

接下来进入breed，进入breed的方法是，先按住Reset键，然后插电源。

然后电源输入网关地址。

![QQ20190716160613](/post_res/2019-07-18-exp-flash-ghl-r-001-router.assets/QQ20190716160613.png)

接下来备份自己的eeprom和flash。

刷入Padavan即可。

![QQ20190716160646](/post_res/2019-07-18-exp-flash-ghl-r-001-router.assets/QQ20190716160646.png)